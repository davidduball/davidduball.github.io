<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masters Pool Form</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header>
        <h1>A Pool Unlike Any Other</h1>
    </header>

    <!-- Form with netlify form handling -->
    <form name="golf-form" method="POST" data-netlify="true" onsubmit="submitForm(event)">
        <!-- Hidden field to tell Netlify which form to handle -->
        <input type="hidden" name="form-name" value="golf-form" />
        
        <!-- Input fields for name and team -->
        <div>
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" required />
        </div>
        <div>
            <label for="team">Team Name:</label>
            <input type="text" id="team" name="team" required />
        </div>

        <!-- Dynamic questions will be inserted here -->
        <div id="questions"></div>

        <!-- Submit button -->
        <button type="submit">Submit</button>
    </form>

    <script>
        // Function to fetch the questions from the JSON file
        async function fetchQuestions() {
            try {
                const response = await fetch('questions.json'); // The URL to your JSON file
                const questionData = await response.json();
                renderQuestions(questionData);
            } catch (error) {
                console.error('Error fetching questions:', error);
            }
        }

        // Function to render the questions dynamically
        function renderQuestions(questionData) {
            const questionsContainer = document.getElementById('questions');
            
            questionData.forEach((categoryData, index) => {
                // Create a fieldset for each category
                const fieldset = document.createElement('fieldset');
                const legend = document.createElement('legend');
                legend.textContent = categoryData.category;
                fieldset.appendChild(legend);

                // Add instruction for each category
                const instruction = document.createElement('p');
                instruction.textContent = categoryData.instruction;
                fieldset.appendChild(instruction);

                // Create inputs (radio buttons or checkboxes) based on category
                categoryData.players.forEach(player => {
                    const div = document.createElement('div');
                    const input = document.createElement('input');
                    
                    if (categoryData.category === 'Choose 2') {
                        input.type = 'checkbox'; // Use checkboxes for the "Choose 2" category
                        input.id = player.name;
                        input.name = `question${index + 1}[]`;  // Use the same name for checkboxes (array)
                        input.value = player.name;
                    } else {
                        input.type = 'radio'; // Use radio buttons for "Choose 1" category
                        input.id = player.name;
                        input.name = `question${index + 1}`;  // Each question needs a unique name for radio buttons
                        input.value = player.name;
                    }

                    const label = document.createElement('label');
                    label.setAttribute('for', player.name);
                    label.textContent = `${player.name} (${player.odds})`;

                    div.appendChild(input);
                    div.appendChild(label);
                    fieldset.appendChild(div);
                });

                // Append the category fieldset to the questions container
                questionsContainer.appendChild(fieldset);
            });
        }

        // Call the fetchQuestions function when the page loads
        window.onload = fetchQuestions;

        // Function to handle form submission
        function submitForm(event) {
            // The form will be submitted automatically via Netlify; we handle this to prevent additional actions
            const formData = new FormData(event.target);
            const data = {
                name: formData.get('name'),
                team: formData.get('team'),
                selectedGolfers: []
            };

            // Collect selected golfers from the radio buttons or checkboxes
            const questionData = JSON.parse(localStorage.getItem('questionData')); // Using localStorage to persist question data temporarily
            questionData.forEach((categoryData, index) => {
                const selectedPlayers = formData.getAll(`question${index + 1}`);
                if (selectedPlayers.length > 0) {
                    data.selectedGolfers.push(...selectedPlayers); // Push multiple players for "Choose 2"
                }
            });

            // Log the collected data (optional for testing)
            console.log(data);
        }
    </script>
</body>
</html>
