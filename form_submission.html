<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masters Pool Form</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header>
        <h1>A Pool Unlike Any Other</h1>
    </header>

    <!-- Form with Netlify form handling -->
    <form name="golf-form" method="POST" data-netlify="true">
        <!-- Hidden field to tell Netlify which form to handle -->
        <input type="hidden" name="form-name" value="golf-form" />

        <!-- Input fields for name and team -->
        <div>
            <label for="name">Your Name:</label>
            <input type="text" id="name" name="name" required />
        </div>
        <div>
            <label for="team">Team Name:</label>
            <input type="text" id="team" name="team" required />
        </div>

        <!-- Dynamic questions will be inserted here -->
        <div id="questions"></div>

        <!-- Submit button -->
        <button type="submit">Submit</button>
    </form>

    <script>
        // Function to fetch the questions from the JSON file
        async function fetchQuestions() {
            try {
                const response = await fetch('questions.json');
                const questionData = await response.json();
                
                // Store question data for later use if needed
                window.questionData = questionData;
                
                renderQuestions(questionData);
                
                // Add hidden fields to the form for Netlify to recognize the dynamic fields
                addHiddenFields(questionData);
            } catch (error) {
                console.error('Error fetching questions:', error);
            }
        }

        // Function to add hidden fields to the form for Netlify form processing
        function addHiddenFields(questionData) {
            const form = document.querySelector('form[name="golf-form"]');
            
            questionData.forEach((categoryData, index) => {
                const fieldName = `question${index + 1}`;
                
                // For "Choose 2" category (checkboxes)
                if (categoryData.category === 'Choose 2') {
                    const hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.name = `${fieldName}[]`;
                    form.appendChild(hiddenField);
                } 
                // For "Choose 1" category (radio buttons)
                else {
                    const hiddenField = document.createElement('input');
                    hiddenField.type = 'hidden';
                    hiddenField.name = fieldName;
                    form.appendChild(hiddenField);
                }
            });
        }

        // Function to render the questions dynamically
        function renderQuestions(questionData) {
            const questionsContainer = document.getElementById('questions');
            
            questionData.forEach((categoryData, index) => {
                // Create a fieldset for each category
                const fieldset = document.createElement('fieldset');
                const legend = document.createElement('legend');
                legend.textContent = categoryData.category;
                fieldset.appendChild(legend);

                // Add instruction for each category
                const instruction = document.createElement('p');
                instruction.textContent = categoryData.instruction;
                fieldset.appendChild(instruction);

                // Create inputs (radio buttons or checkboxes) based on category
                categoryData.players.forEach(player => {
                    const div = document.createElement('div');
                    const input = document.createElement('input');
                    
                    // Create a safe ID by removing spaces and special characters
                    const safePlayerId = player.name.replace(/[^a-zA-Z0-9]/g, '');
                    
                    if (categoryData.category === 'Choose 2') {
                        input.type = 'checkbox';
                        input.id = safePlayerId;
                        input.name = `question${index + 1}`;  // Netlify wants consistent name 
                        input.value = player.name;
                        
                        // Optional: Limit selections to 2 for "Choose 2" category
                        input.addEventListener('change', function() {
                            limitCheckboxSelection(`question${index + 1}`, 2);
                        });
                    } else {
                        input.type = 'radio';
                        input.id = safePlayerId;
                        input.name = `question${index + 1}`;
                        input.value = player.name;
                    }

                    const label = document.createElement('label');
                    label.setAttribute('for', safePlayerId);
                    label.textContent = `${player.name} (${player.odds})`;

                    div.appendChild(input);
                    div.appendChild(label);
                    fieldset.appendChild(div);
                });

                // Append the category fieldset to the questions container
                questionsContainer.appendChild(fieldset);
            });
        }
        
        // Function to limit checkbox selection to a maximum number
        function limitCheckboxSelection(name, max) {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
            if (checkboxes.length > max) {
                checkboxes[checkboxes.length - 1].checked = false;
            }
        }

        // Call the fetchQuestions function when the page loads
        window.onload = fetchQuestions;
    </script>
</body>
</html>
